# Mini Taipei

å°åŒ—æ·é‹å³æ™‚åˆ—è»Šæ¨¡æ“¬ç³»çµ± - åœ¨åœ°åœ–ä¸Šè¦–è¦ºåŒ–å‘ˆç¾åˆ—è»Šé‹è¡Œç‹€æ…‹

![React](https://img.shields.io/badge/React-19-blue) ![TypeScript](https://img.shields.io/badge/TypeScript-5.9-blue) ![Mapbox](https://img.shields.io/badge/Mapbox%20GL-3.17-orange)

## è‡´è¬èˆ‡è³‡æ–™ä¾†æº

æœ¬å°ˆæ¡ˆä½¿ç”¨ä»¥ä¸‹é–‹æºè³‡æ–™èˆ‡å°ˆæ¡ˆï¼š

### éˆæ„Ÿä¾†æº
- [Mini Tokyo 3D](https://github.com/nagix/mini-tokyo-3d) by [@nagix](https://github.com/nagix) - è¶…è®šçš„æ±äº¬äº¤é€šå³æ™‚ 3D è¦–è¦ºåŒ–å°ˆæ¡ˆï¼Œè®“æˆ‘èƒ½å¤ å­¸ç¿’ï¼

### æ™‚åˆ»è¡¨è³‡æ–™
æ„Ÿè¬ [@ericyu](https://github.com/ericyu) çš„é–‹æºå°ˆæ¡ˆï¼š
- [TaipeiMetroTimeTable](https://github.com/ericyu/TaipeiMetroTimeTable) - å°åŒ—æ·é‹æ™‚åˆ»è¡¨è³‡æ–™
- [TaipeiMetroRouteInfo](https://github.com/ericyu/TaipeiMetroRouteInfo) - å°åŒ—æ·é‹è·¯ç·šè³‡è¨Š

### è»Œé“èˆ‡è»Šç«™è³‡æ–™
- [TDX é‹è¼¸è³‡æ–™æµé€šæœå‹™](https://tdx.transportdata.tw/) - æä¾›è»Œé“ GeoJSON èˆ‡è»Šç«™ä½ç½®

## åŠŸèƒ½ç‰¹è‰²

- **å³æ™‚åˆ—è»Šæ¨¡æ“¬** - æ ¹æ“šçœŸå¯¦æ™‚åˆ»è¡¨æ¨¡æ“¬åˆ—è»Šé‹è¡Œ
- **Mapbox åœ°åœ–è¦–è¦ºåŒ–** - ä½¿ç”¨ Mapbox GL JS å‘ˆç¾ç²¾ç¾åœ°åœ–
- **å®Œæ•´è·¯ç¶²æ”¯æ´** - æ”¯æ´å¤§å°åŒ—åœ°å€å…¨éƒ¨æ·é‹ã€è¼•è»Œèˆ‡è²“ç©ºçºœè»Š
- **2D / 3D æ¨¡å¼åˆ‡æ›** - æ”¯æ´å¹³é¢èˆ‡ç«‹é«”è¦–è§’ï¼Œ3D æ¨¡å¼ä¸‹åˆ—è»Šä»¥æ–¹å¡Šå‘ˆç¾
- **åˆ—è»Šè·Ÿéš¨æ¨¡å¼** - é»æ“Šåˆ—è»Šå¯é–‹å•Ÿè·Ÿéš¨ï¼Œè‡ªå‹•è¿½è¹¤åˆ—è»Šä½ç½®
- **æ—¥å¤œä¸»é¡Œåˆ‡æ›** - æ”¯æ´ Autoï¼ˆéš¨æ™‚é–“è‡ªå‹•åˆ‡æ›ï¼‰ã€Dawnã€Dayã€Duskã€Nightã€Dark å…­ç¨®ä¸»é¡Œ
- **æ™‚é–“æ§åˆ¶** - å¯èª¿æ•´æ¨¡æ“¬é€Ÿåº¦ (1x-300x) èˆ‡è·³è½‰æ™‚é–“
- **å»¶é•·æ—¥æ™‚é–“è»¸** - æ”¯æ´ç‡Ÿé‹æ™‚é–“ 06:00 è‡³éš”æ—¥ 01:30
- **è·¯ç·šç¯©é¸** - MRT / Cable åˆ†é¡ç¯©é¸ï¼Œè²“ç©ºçºœè»Šæ”¯æ´ä¸‰æ®µå¼æ§åˆ¶
- **ç¢°æ’åµæ¸¬** - è‡ªå‹•åµæ¸¬åˆ—è»Šç¢°æ’ä¸¦è¦–è¦ºåŒ–æ¨™ç¤º
- **åœç«™å‹•ç•«** - åˆ—è»Šåˆ°ç«™æ™‚æœƒæœ‰è¦–è¦ºç‹€æ…‹è®ŠåŒ–

## æ”¯æ´è·¯ç·š

| è·¯ç·š | ä»£ç¢¼ | è»Šç«™æ•¸ | ç‡Ÿé‹æ¨¡å¼ |
|------|------|--------|----------|
| ğŸ”´ æ·¡æ°´ä¿¡ç¾©ç·š | R | 28 ç«™ | å…¨ç¨‹è»Šã€å€é–“è»Šã€æ–°åŒ—æŠ•æ”¯ç·š |
| ğŸŸ¢ æ¾å±±æ–°åº—ç·š | G | 20 ç«™ | å…¨ç¨‹è»Šã€å°ç¢§æ½­æ”¯ç·š |
| ğŸŸ  ä¸­å’Œæ–°è˜†ç·š | O | 27 ç«™ | è¿´é¾ç·šã€è˜†æ´²ç·š |
| ğŸ”µ æ¿å—ç·š | BL | 23 ç«™ | å…¨ç¨‹è»Šã€å€é–“è»Š |
| ğŸŸ¤ æ–‡æ¹–ç·š | BR | 24 ç«™ | å…¨è‡ªå‹•ç„¡äººé§•é§› |
| ğŸŸ¡ ç’°ç‹€ç·š | Y | 14 ç«™ | ç¬¬ä¸€éšæ®µ |
| ğŸŸ£ æ¡ƒåœ’æ©Ÿå ´æ·é‹ | A | 22 ç«™ | æ™®é€šè»Šã€ç›´é”è»Šã€åŠ ç­ç›´é”è»Š |
| ğŸ’š å®‰å‘è¼•è»Œ | K | 9 ç«™ | è¼•è»Œ |
| ğŸ©µ æ·¡æµ·è¼•è»Œ | V | 11 ç«™ | ç¶ å±±ç·š |
| ğŸš¡ è²“ç©ºçºœè»Š | MK | 4 ç«™ | çºœè»Šï¼ˆä¸‰æ®µå¼é¡¯ç¤ºæ§åˆ¶ï¼‰ |

## æŠ€è¡“æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    App.tsx                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Mapbox GL  â”‚  â”‚ TimeEngine  â”‚  â”‚ TrainEngine â”‚ â”‚
â”‚  â”‚   (åœ°åœ–)    â”‚  â”‚  (æ™‚é–“æ¨¡æ“¬)  â”‚  â”‚  (åˆ—è»Šé‚è¼¯)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â†‘               â†“               â†“          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                    useData Hook                     â”‚
â”‚           (è¼‰å…¥ GeoJSON + æ™‚åˆ»è¡¨è³‡æ–™)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡çµ„

| æ¨¡çµ„ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| TimeEngine | `src/engines/TimeEngine.ts` | æ¨¡æ“¬æ™‚é–“å¼•æ“ï¼Œæ”¯æ´æš«åœã€åŠ é€Ÿã€è·³è½‰ |
| TrainEngine | `src/engines/TrainEngine.ts` | åˆ—è»Šç‹€æ…‹ç®¡ç†ã€ä½ç½®æ’å€¼ã€ç¢°æ’åµæ¸¬ |
| Train3DLayer | `src/layers/Train3DLayer.ts` | 3D åˆ—è»Šåœ–å±¤ï¼Œä½¿ç”¨ Three.js æ¸²æŸ“ |
| useData | `src/hooks/useData.ts` | è³‡æ–™è¼‰å…¥ Hookï¼Œè™•ç† GeoJSON èˆ‡æ™‚åˆ»è¡¨ |
| TimeControl | `src/components/TimeControl.tsx` | æ™‚é–“æ§åˆ¶é¢æ¿ UI å…ƒä»¶ |
| ThemeToggle | `src/components/ThemeToggle.tsx` | æ—¥å¤œä¸»é¡Œåˆ‡æ›å…ƒä»¶ |
| LineFilter | `src/components/LineFilter.tsx` | è·¯ç·šç¯©é¸å…ƒä»¶ï¼ˆMRT / Cable åˆ†é¡ï¼‰ |
| TrainInfoPanel | `src/components/TrainInfoPanel.tsx` | åˆ—è»Šè·Ÿéš¨è³‡è¨Šé¢æ¿ |
| TrainHistogram | `src/components/TrainHistogram.tsx` | åˆ—è»Šæ•¸é‡è¶¨å‹¢åœ– |

## å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒéœ€æ±‚

- Node.js 18+
- npm æˆ– yarn
- Mapbox Access Token ([ç”³è«‹é€£çµ](https://account.mapbox.com/access-tokens/))

### å®‰è£æ­¥é©Ÿ

```bash
# å®‰è£ä¾è³´
npm install

# è¨­å®šç’°å¢ƒè®Šæ•¸
cp .env.example .env
# ç·¨è¼¯ .envï¼Œå¡«å…¥ä½ çš„ Mapbox Token

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev
```

é–‹å•Ÿ http://localhost:5173 å³å¯çœ‹åˆ°åˆ—è»Šæ¨¡æ“¬

### å»ºç½®ç”Ÿç”¢ç‰ˆæœ¬

```bash
npm run build
npm run preview  # é è¦½å»ºç½®çµæœ
```

## å°ˆæ¡ˆçµæ§‹

```
mini-taipei/
â”œâ”€â”€ src/                      # React åŸå§‹ç¢¼
â”‚   â”œâ”€â”€ components/           # UI å…ƒä»¶
â”‚   â”‚   â””â”€â”€ TimeControl.tsx   # æ™‚é–“æ§åˆ¶é¢æ¿
â”‚   â”œâ”€â”€ engines/              # æ ¸å¿ƒå¼•æ“
â”‚   â”‚   â”œâ”€â”€ TimeEngine.ts     # æ™‚é–“æ¨¡æ“¬å¼•æ“
â”‚   â”‚   â””â”€â”€ TrainEngine.ts    # åˆ—è»Šé‹ç®—å¼•æ“
â”‚   â”œâ”€â”€ hooks/                # React Hooks
â”‚   â”‚   â””â”€â”€ useData.ts        # è³‡æ–™è¼‰å…¥
â”‚   â””â”€â”€ types/                # TypeScript å‹åˆ¥
â”œâ”€â”€ public/data/              # éœæ…‹è³‡æ–™
â”‚   â”œâ”€â”€ tracks/               # è»Œé“ GeoJSON (92 æ¢)
â”‚   â”œâ”€â”€ schedules/            # æ™‚åˆ»è¡¨ JSON (92 å€‹)
â”‚   â”œâ”€â”€ station_progress.json # è»Šç«™é€²åº¦å°ç…§è¡¨
â”‚   â””â”€â”€ *_stations.geojson    # å„è·¯ç·šè»Šç«™è³‡æ–™
â”œâ”€â”€ tools/data_collector/     # è³‡æ–™è½‰æ›å·¥å…·
â”‚   â”œâ”€â”€ convert_ericyu_timetable.py
â”‚   â”œâ”€â”€ create_intermediate_tracks.py
â”‚   â””â”€â”€ source/               # åŸå§‹è³‡æ–™
â””â”€â”€ docs/                     # å…§éƒ¨æ–‡ä»¶
```

---

# æŠ€è¡“æ–‡ä»¶

## åˆ—è»Šå‹•ç•«åŸç†

### è»Šç«™é€²åº¦æ˜ å°„ (Station Progress)

æ¯æ¢è»Œé“æ˜¯ä¸€æ¢ LineStringï¼Œåˆ—è»Šä½ç½®ç”¨ **é€²åº¦å€¼ (0-1)** è¡¨ç¤ºï¼š

```
è»Œé“èµ·é» â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€ è»Œé“çµ‚é»
  0.0       0.25    0.5   0.75      1.0
           ç«™A     ç«™B    ç«™C
```

`station_progress.json` å„²å­˜æ¯å€‹è»Šç«™åœ¨å„è»Œé“ä¸Šçš„å¯¦éš›é€²åº¦ï¼š

```json
{
  "R-1-0": {
    "R02": 0.0,      // è±¡å±±ç«™ï¼šè»Œé“èµ·é»
    "R03": 0.0276,   // å°åŒ—101ç«™
    "R04": 0.0657,   // ä¿¡ç¾©å®‰å’Œç«™
    ...
    "R28": 1.0       // æ·¡æ°´ç«™ï¼šè»Œé“çµ‚é»
  }
}
```

### ä½ç½®æ’å€¼æ¼”ç®—æ³•

åˆ—è»Šä½ç½®æ ¹æ“šæ™‚åˆ»è¡¨è¨ˆç®—ï¼š

```
1. å¾æ™‚åˆ»è¡¨æ‰¾å‡ºç•¶å‰ç‹€æ…‹ï¼šåœç«™ä¸­ or è¡Œé§›ä¸­
2. è‹¥åœç«™ä¸­ï¼šä½ç½® = è©²ç«™çš„ progress å€¼
3. è‹¥è¡Œé§›ä¸­ï¼š
   - è¨ˆç®—å€æ®µé€²åº¦ = (ç•¶å‰æ™‚é–“ - é›¢ç«™æ™‚é–“) / (ä¸‹ç«™åˆ°é” - é›¢ç«™æ™‚é–“)
   - ä½ç½® = ç·šæ€§æ’å€¼(èµ·ç«™progress, çµ‚ç«™progress, å€æ®µé€²åº¦)
4. å°‡ progress è½‰æ›ç‚ºå¯¦éš›ç¶“ç·¯åº¦åº§æ¨™
```

```typescript
// TrainEngine.ts æ ¸å¿ƒé‚è¼¯
function interpolateBetweenStations(
  coords: [number, number][],
  fromProgress: number,  // èµ·ç«™é€²åº¦ (å¦‚ 0.25)
  toProgress: number,    // çµ‚ç«™é€²åº¦ (å¦‚ 0.5)
  segmentProgress: number // å€æ®µé€²åº¦ (0-1)
): [number, number] {
  const actualProgress = fromProgress + (toProgress - fromProgress) * segmentProgress;
  return interpolateOnLineString(coords, actualProgress);
}
```

## ç¢°æ’åµæ¸¬ç³»çµ±

### å•é¡ŒèƒŒæ™¯

æ·¡æ°´ä¿¡ç¾©ç·šæœ‰å¤šç¨®ç‡Ÿé‹æ¨¡å¼å…±ç”¨åŒä¸€å¯¦é«”è»Œé“ï¼š
- R-1 å…¨ç¨‹è»Š (è±¡å±± â†” æ·¡æ°´)
- R-2 å€é–“è»Š (è±¡å±± â†” åŒ—æŠ•)
- R-4 åŒ—æ®µè»Š (åŒ—æŠ• â†” æ·¡æ°´)

ç•¶å…©è¼›ä¸åŒè·¯ç·šçš„åˆ—è»Šåœ¨åŒä¸€ç‰©ç†ä½ç½®æ™‚ï¼Œéœ€è¦è¦–è¦ºåŒ–å€åˆ†ã€‚

### è§£æ±ºæ–¹æ¡ˆ

```typescript
// å®šç¾©å…±ç”¨è»Œé“å€æ®µ
const SHARED_TRACK_SEGMENTS = {
  'R-1-0': ['R05', 'R06', ..., 'R22'],  // å¤§å®‰åˆ°åŒ—æŠ•
  'R-2-0': ['R05', 'R06', ..., 'R22'],  // ç›¸åŒå€æ®µ
  ...
};

// ç¢°æ’åµæ¸¬æµç¨‹
1. å°‡åˆ—è»ŠæŒ‰è¡Œé§›æ–¹å‘åˆ†çµ„
2. æª¢æŸ¥åŒæ–¹å‘åˆ—è»Šé–“çš„è·é›¢
3. è‹¥è·é›¢ < é–¾å€¼ (ç´„ 50 å…¬å°º)ï¼š
   - æ¨™è¨˜ç‚ºç¢°æ’ç‹€æ…‹
   - è¨ˆç®—å‚ç›´æ–¼è»Œé“çš„åç§»å‘é‡
   - åˆ†åˆ¥å‘å…©å´åç§»é¡¯ç¤º
```

### è¦–è¦ºæ•ˆæœ

- **æ­£å¸¸è¡Œé§›**ï¼šç™½è‰²é‚Šæ¡†åœ“é»
- **åœç«™ä¸­**ï¼šè¼ƒå¤§åœ“é» + è„ˆå‹•æ•ˆæœ
- **ç¢°æ’ä¸­**ï¼šé»ƒè‰²é‚Šæ¡† + è­¦ç¤ºå…‰æšˆ + ä½ç½®åç§»

## é¦–ç­è»Šå•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### å•é¡Œæè¿°

é¦–ç­è»Šå¸¸å¾ä¸­é€”ç«™ç™¼è»Šï¼ˆå¦‚å¤§å®‰ã€é›™é€£ï¼‰ï¼Œè€Œéèµ·é»ç«™ï¼ˆè±¡å±±ã€æ·¡æ°´ï¼‰ã€‚è‹¥ä½¿ç”¨å®Œæ•´è»Œé“è¨ˆç®—é€²åº¦ï¼Œæœƒå‡ºç¾ã€Œç¬ç§»ã€ç¾è±¡ï¼š

```
å•é¡Œï¼šå¤§å®‰ç«™é¦–ç­è»Šä½¿ç”¨ R-1-0 è»Œé“
- R-1-0 å®šç¾©ï¼šè±¡å±± (0.0) â†’ æ·¡æ°´ (1.0)
- å¤§å®‰ç«™åœ¨ R-1-0 çš„é€²åº¦ï¼š0.104
- é¦–ç­è»Šå¾é€²åº¦ 0.104 é–‹å§‹ï¼Œä½†æ™‚åˆ»è¡¨çš„ã€Œç›¸å°æ™‚é–“ã€å¾ 0 é–‹å§‹
- å°è‡´åˆ—è»Šä¸€é–‹å§‹å°±ã€Œé£›ã€åˆ°éŒ¯èª¤ä½ç½®
```

### è§£æ±ºæ–¹æ¡ˆï¼šå°ˆç”¨è»Œé“

ç‚ºæ¯å€‹ã€Œéæ¨™æº–èµ·é»ã€çš„ç­æ¬¡å»ºç«‹å°ˆå±¬è»Œé“ï¼š

```
æ¨™æº–è»Œé“ï¼š
R-1-0: è±¡å±± (0.0) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ·¡æ°´ (1.0)

é¦–ç­è»Šå°ˆç”¨è»Œé“ï¼š
R-5-0: å¤§å®‰ (0.0) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ·¡æ°´ (1.0)
R-6-0: é›™é€£ (0.0) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ·¡æ°´ (1.0)
...
```

### è»Œé“åˆ†é¡

| è»Œé“ ID | é¡å‹ | èµ·é» â†’ çµ‚é» | ç”¨é€” |
|---------|------|-------------|------|
| R-1-0/1 | ä¸»ç·š | è±¡å±± â†” æ·¡æ°´ | å…¨ç¨‹è»Š |
| R-2-0/1 | å€é–“ | è±¡å±± â†” åŒ—æŠ• | å—æ®µå€é–“è»Š |
| R-3-0/1 | æ”¯ç·š | åŒ—æŠ• â†” æ–°åŒ—æŠ• | æ–°åŒ—æŠ•æ”¯ç·š |
| R-4-0/1 | åŒ—æ®µ | åŒ—æŠ• â†” æ·¡æ°´ | åŒ—æ®µå€é–“è»Š |
| R-5-0 ~ R-8-0 | é¦–ç­è»Š | ä¸­é€”ç«™ â†’ æ·¡æ°´ | åŒ—ä¸Šé¦–ç­è»Š |
| R-9-1 ~ R-15-1 | é¦–ç­è»Š | ä¸­é€”ç«™ â†’ è±¡å±± | å—ä¸‹é¦–ç­è»Š |

### è»Œé“å¯è¦‹æ€§

é¦–ç­è»Šå°ˆç”¨è»Œé“è¨­ç‚ºé€æ˜ (opacity: 0)ï¼Œå› ç‚ºå®ƒå€‘èˆ‡ä¸»ç·šç‰©ç†é‡ç–Šï¼š

```typescript
// App.tsx
'line-opacity': [
  'case',
  ['in', 'R-1', ['get', 'track_id']], 0.8,  // ä¸»ç·šå¯è¦‹
  ['in', 'R-3', ['get', 'track_id']], 0.8,  // æ”¯ç·šå¯è¦‹
  0.0  // å…¶ä»–é€æ˜ (é¿å…é‡è¤‡é¡¯ç¤º)
]
```

## å»¶é•·æ—¥æ™‚é–“è™•ç†

### å•é¡ŒèƒŒæ™¯

æ·é‹ç‡Ÿé‹æ™‚é–“æ©«è·¨åˆå¤œï¼ˆæœ«ç­è»Šç´„ 01:00-01:30 æŠµé”ï¼‰ï¼Œå‚³çµ± 0-24 æ™‚åˆ¶ç„¡æ³•é€£çºŒè¡¨ç¤ºã€‚

### è§£æ±ºæ–¹æ¡ˆ

ä½¿ç”¨ã€Œå»¶é•·æ—¥ã€æ¦‚å¿µï¼š

```
å‚³çµ±æ™‚åˆ¶ï¼š00:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 23:59
          â”‚                               â”‚
          â””â”€â”€â”€ è·³å›é–‹é ­ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å»¶é•·æ—¥æ™‚åˆ¶ï¼š06:00 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 01:30 (25:30)
            â”‚        â”‚        â”‚        â”‚        â”‚
          06:00   12:00   18:00   24:00   01:30
```

```typescript
// TimeControl.tsx
function toExtendedSeconds(standardSeconds: number): number {
  // å‡Œæ™¨ 00:00-05:59 è¦–ç‚º 24:00-29:59
  if (standardSeconds < 6 * 3600) {
    return standardSeconds + 24 * 3600;
  }
  return standardSeconds;
}
```

---

## è³‡æ–™æ”¶é›†èˆ‡è½‰æ›å·¥å…·

### å·¥å…·æ¦‚è¦½

```
tools/data_collector/
â”œâ”€â”€ convert_ericyu_timetable.py  # æ™‚åˆ»è¡¨è½‰æ› (ä¸»è¦å·¥å…·)
â”œâ”€â”€ create_intermediate_tracks.py # é¦–ç­è»Šè»Œé“å»ºç«‹
â””â”€â”€ source/
    â””â”€â”€ ericyu_R.json            # Eric Yu æ™‚åˆ»è¡¨åŸå§‹è³‡æ–™
```

### è½‰æ›æµç¨‹

æœ¬å°ˆæ¡ˆåƒè€ƒ [Eric Yu çš„ TaipeiMetroTimeTable](https://github.com/ericyu/TaipeiMetroTimeTable) æ ¼å¼è¨­è¨ˆï¼Œè½‰æ›å·¥å…·å¯å¥—ç”¨è‡³ TDX å–å¾—çš„å…¶ä»–è·¯ç·šè³‡æ–™ï¼š

```bash
cd tools/data_collector

# 1. è½‰æ›æ™‚åˆ»è¡¨
python convert_ericyu_timetable.py

# 2. å»ºç«‹é¦–ç­è»Šå°ˆç”¨è»Œé“ (å¦‚æœ‰éœ€è¦)
python create_intermediate_tracks.py
```

### è½‰æ›å™¨è¼¸å‡º

```
è¼¸å‡ºç›®éŒ„: public/data/schedules/
  âœ… R-1-0.json: 133 ç­è»Š
  âœ… R-1-1.json: 133 ç­è»Š
  âœ… R-2-0.json: 120 ç­è»Š
  ...
  âœ… R-15-1.json: 1 ç­è»Š (é¦–ç­è»Šå°ˆç”¨)
```

### æ“´å±•è‡³å…¶ä»–è·¯ç·š

1. å¾ TDX å–å¾—è©²è·¯ç·šçš„æ™‚åˆ»è¡¨è³‡æ–™
2. è½‰æ›ç‚º Eric Yu æ ¼å¼ (æˆ–ç›´æ¥ä¿®æ”¹è½‰æ›å™¨)
3. æº–å‚™è»Œé“ GeoJSON èˆ‡è»Šç«™è³‡æ–™
4. å»ºç«‹ `station_progress.json` æ˜ å°„
5. æ›´æ–°å‰ç«¯è¼‰å…¥æ–°è»Œé“

## è³‡æ–™æ ¼å¼è¦æ ¼

### è»Œé“è³‡æ–™ (GeoJSON)

```json
{
  "type": "FeatureCollection",
  "features": [{
    "type": "Feature",
    "properties": {
      "track_id": "R-1-0",
      "route_id": "R-1",
      "direction": 0,
      "name": "è±¡å±± â†’ æ·¡æ°´",
      "color": "#d90023"
    },
    "geometry": {
      "type": "LineString",
      "coordinates": [[121.xxx, 25.xxx], ...]
    }
  }]
}
```

### æ™‚åˆ»è¡¨è³‡æ–™ (JSON)

```json
{
  "track_id": "R-1-0",
  "route_id": "R-1",
  "name": "è±¡å±± â†’ æ·¡æ°´",
  "origin": "R02",
  "destination": "R28",
  "stations": ["R02", "R03", ...],
  "departure_count": 133,
  "departures": [{
    "train_id": "R-1-0-001",
    "departure_time": "06:00:00",
    "origin_station": "R02",
    "total_travel_time": 3240,
    "stations": [
      { "station_id": "R02", "arrival": 0, "departure": 40 },
      { "station_id": "R03", "arrival": 140, "departure": 180 },
      ...
    ]
  }]
}
```

### è»Šç«™é€²åº¦æ˜ å°„ (JSON)

```json
{
  "R-1-0": {
    "R02": 0.0,
    "R03": 0.027612,
    ...
    "R28": 1.0
  },
  "R-5-0": {
    "R05": 0.0,
    "R06": 0.020248,
    ...
    "R28": 1.0
  }
}
```

## ç’°å¢ƒè®Šæ•¸

```env
VITE_MAPBOX_TOKEN=your_mapbox_token_here
```

å–å¾— Mapbox Token: https://account.mapbox.com/access-tokens/

## æŠ€è¡“æ£§

| å±¤ç´š | æŠ€è¡“ |
|------|------|
| å‰ç«¯ | React 19 + TypeScript + Vite |
| åœ°åœ– | Mapbox GL JS |
| è»Œé“è³‡æ–™ | TDX é‹è¼¸è³‡æ–™æµé€šæœå‹™ |
| æ™‚åˆ»è¡¨è³‡æ–™ | Eric Yu é–‹æºå°ˆæ¡ˆ + TDX API |

## é–‹ç™¼æ­·ç¨‹

### 2026-01-01
- âœ¨ æ–°å¢ 2D / 3D æ¨¡å¼åˆ‡æ›åŠŸèƒ½ï¼Œ3D æ¨¡å¼ä½¿ç”¨ Three.js æ¸²æŸ“ç«‹é«”åˆ—è»Š
- âœ¨ æ–°å¢åˆ—è»Šè·Ÿéš¨æ¨¡å¼ï¼Œé»æ“Šåˆ—è»Šå¯è‡ªå‹•è¿½è¹¤ä½ç½®ä¸¦é¡¯ç¤ºè©³ç´°è³‡è¨Š
- âœ¨ æ–°å¢æ—¥å¤œä¸»é¡Œåˆ‡æ›åŠŸèƒ½ï¼ˆAuto / Dawn / Day / Dusk / Night / Darkï¼‰
- âœ¨ æ–°å¢è²“ç©ºçºœè»Š (MK) æ”¯æ´ï¼Œå«ä¸‰æ®µå¼é¡¯ç¤ºæ§åˆ¶
- âœ¨ æ–°å¢ MRT / Cable åˆ†é¡ç¯©é¸å™¨
- âœ¨ æ‰€æœ‰ UI é¢æ¿æ”¯æ´ä¸»é¡Œè‡ªå‹•åˆ‡æ›ï¼ˆæ˜/æš—è‰²é…åˆåœ°åœ–ä¸»é¡Œï¼‰
- âœ¨ è»Œé“åœ–å±¤åŠ å…¥ emissive-strengthï¼Œå¤œé–“æ¨¡å¼ä¿æŒæ˜äº®
- ğŸ¨ æ–°å¢åˆ—è»Šæ•¸é‡è¶¨å‹¢ç›´æ–¹åœ–
- ğŸ¨ å„ªåŒ– 3D è·Ÿéš¨æ¨¡å¼è¦–è§’æ§åˆ¶ï¼Œå…è¨±è‡ªç”±æ—‹è½‰
- ğŸ› ä¿®æ­£åœ°åœ–æ¨£å¼åˆ‡æ›å¾Œåœ–å±¤æ¶ˆå¤±å•é¡Œ
- ğŸ› ä¿®æ­£å•Ÿå‹•æ™‚åœ°åœ–æ¨£å¼é–ƒçˆå•é¡Œ
- âš¡ å„ªåŒ– 3D æ¨¡å¼æ•ˆèƒ½ï¼ˆæè³ªå…±ç”¨ã€ç¯€æµæ¸²æŸ“ï¼‰

### 2025-12-31
- âœ¨ æ–°å¢æ–°åŒ—ç’°ç‹€ç·š (Y) å®Œæ•´å¯¦ä½œ
- âœ¨ æ–°å¢æ¡ƒåœ’æ©Ÿå ´æ·é‹ (A) - æ”¯æ´æ™®é€šè»Šã€åŸºæœ¬ç›´é”è»Šã€åŠ ç­ç›´é”è»Šä¸‰ç¨®ç‡Ÿé‹æ¨¡å¼
- âœ¨ æ–°å¢å®‰å‘è¼•è»Œ (K) èˆ‡æ·¡æµ·è¼•è»Œ (V)
- âœ¨ æ–°å¢æ–‡æ¹–ç·š (BR) å®Œæ•´å¯¦ä½œ
- ğŸ› ä¿®æ­£æ©Ÿå ´æ·é‹ç›´é”è»Šæ™‚é–“ï¼ˆæ ¹æ“šå®˜æ–¹æ™‚åˆ»è¡¨æ ¡æº–ç‚º 39 åˆ†é˜ï¼‰
- ğŸ› ä¿®æ­£ station_progress è»Šç«™å°é½Šå•é¡Œ

### 2025-12-30
- âœ¨ æ–°å¢ä¸­å’Œæ–°è˜†ç·š (O) æ¨¡æ“¬
- âœ¨ æ–°å¢æ¾å±±æ–°åº—ç·š (G) å«å°ç¢§æ½­æ”¯ç·š
- âœ¨ æ–°å¢æ¿å—ç·š (BL) æ¨¡æ“¬
- âœ¨ æ–°å¢ UI å¢å¼·åŠŸèƒ½ï¼ˆè·¯ç·šç¯©é¸ã€æ™‚é–“æ§åˆ¶å„ªåŒ–ï¼‰
- ğŸ› ä¿®æ­£å¤šæ¢è·¯ç·šè»Œé“æ ¡æº–å•é¡Œ
- ğŸ› æ’é™¤ä¸åŒç·šè·¯çš„ç¢°æ’æª¢æ¸¬

### 2025-12-29
- âœ¨ æ–°å¢é¦–ç­è»Šå°ˆç”¨è»Œé“è§£æ±ºä¸­é€”ç«™å‡ºç™¼å•é¡Œ
- âœ¨ æ–°å¢å»¶é•·æ—¥æ™‚é–“è»¸ (06:00 ~ éš”æ—¥ 01:30)
- âœ¨ UI å„ªåŒ– - é€Ÿåº¦æ§åˆ¶ã€åœ–ä¾‹ã€æ™‚é–“è»¸èª¿æ•´
- ğŸ› ä¿®æ­£é¦–ç­è»Šè»Œé“åº§æ¨™å°é½Šå•é¡Œ

### å°ˆæ¡ˆåˆæœŸ
- ğŸ‰ ä½¿ç”¨ Eric Yu é–‹æºæ™‚åˆ»è¡¨è³‡æ–™
- ğŸ‰ æ·¡æ°´ä¿¡ç¾©ç·š (R) åŸºç¤å¯¦ä½œ
- ğŸ‰ æ•´åˆ Mapbox GL JS åœ°åœ–è¦–è¦ºåŒ–

## æˆæ¬Š

MIT License
